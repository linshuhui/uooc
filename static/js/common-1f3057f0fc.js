!function(){var e=angular.module("common.module",[]);e.factory("uoocService",["$http","$httpParamSerializerJQLike","$q",function(e,t,n){var r=!1,a={ajaxHttpEx:function(r,o,i,s){o=o||{},i=i||"GET";var c;o.load!==!1?c=layer.load():delete o.load;var l,d;return"POST"==i?l=_.isString(o)?o:t(o):d=o,e({method:i,url:r,data:l,params:d,headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8",XSRF:angular.element("meta[name=_xsrf]").attr("content")}}).then(function(e){if(!angular.isObject(e.data))return n.reject({msg:"数据格式错误"});if(1!=e.data.code)return n.reject(e.data);var t=e.data||{};return"function"==typeof s&&s(t),t},function(e){return e.status?200!=e.status?n.reject({msg:"网络请求超时，请稍后重试。"}):void 0:n.reject({msg:"出现错误..."})})["catch"](function(e){if(401==e.code)a.showLogin();else if(601==e.code){var t="<h2>请修正下列错误：</h2><ul>";_.each(e.data,function(e){t+="<li>"+e+"</li>"}),t+="</ul>",layer.alert(t,{title:e.msg})}else 555==e.code?layer.alert(e.msg,{title:"警告",shadeClose:0,closeBtn:0,move:!1,btn:["重置密码"]},function(){window.top.location.href="/user/forgot"}):450==e.code?layer.alert("您当前身份没有验证,请前往认证",{btn:["前往认证"]},function(){location.href="/home#/center/identify/student"}):o.hidemsg_||layer.msg(e.msg||"出现错误",{offset:"300px"});return n.reject(e)})["finally"](function(){c&&layer.close(c)})},showLogin:function(){if(r)return!1;r=!0;var e=location.href,t="/"==$(".header ul .active").attr("href");this.layerOpen({width:"640px",height:"540px",skin:"login-layer",zIndex:99999999,content:["/user/login?fromurl="+e+"&home="+(t?1:0),"no"],success:function(){},end:function(){r=!1}})},layerLogin:function(){this.ajaxHttpEx("/home/announce/getUnreadCnt",{hidemsg_:!0,load:!1},"GET").then(function(){location.reload()})},checkLogin:function(){return this.ajaxHttpEx("/home/announce/getUnreadCnt",{hidemsg_:!0,load:!1},"GET")},layerRegister:function(){this.layerOpen({width:"670px",height:"645px",skin:"login-layer",zIndex:99999999,content:["/userapp/register","no"]})},loginActive:function(){window.top.layer.confirm("你的邮箱没有激活,是否前往激活",{btn:["前往激活","取消"]},function(){swindow.location.href="/user/active",swindow.layer.closeAll()},function(){curWindow==window?swindow.location.href="/":swindow.location.reload()})},refreshCode:function(e){return"string"==typeof e&&(e=document.getElementById(e)),oldSrc_=e.getAttribute("src").replace(/\?.+$/,""),curSrc_=oldSrc_+"?"+Math.random(),e.setAttribute("src",curSrc_),e},layerOpen:function(e,t){var n=window.layer;t&&(n=window.parent.layer);var r={closeBtn:1,type:2,move:!1,title:!1,fix:!1,shadeClose:!0,maxmin:!1,offset:"auto",scrollbar:!1,moveType:1,area:[e.width||"400px",e.height||"500px"]};return e=$.extend(!0,r,e),n.open(e)},closeSelfModel:function(){var e=parent.layer.getFrameIndex(window.name);parent.layer.close(e)},refreshWindow:function(e,t){var n=e;if(arguments.length>=2)for(;n.parent&&t>0;)t--,n=n.parent;n.location.reload()},browser:function(){var e={msie:!1,chrome:!1,firefox:!1,opera:!1,safari:!1,name:"unknown",version:0},t=window.navigator.userAgent.toLowerCase();return/(msie|chrome|firefox|opera|netscape)\D+(\d[\d.]*)/.test(t)?(e[RegExp.$1]=!0,e.name=RegExp.$1,e.version=RegExp.$2):/version\D+(\d[\d.]*).*safari/.test(t)&&(e.safari=!0,e.name="safari",e.version=RegExp.$2),e},searchToObj:function(e){for(var t=e||window.location.search,n=t.substring(1).split("&"),r={},a=0;a<n.length;a++){var o=n[a].split("=");r[o[0]]=o[1]}return r},newWin:function(e){var t=window.open("about:blank");t.location.href=e},setCookie:function(e,t,n,r){var e=escape(e),t=escape(t),a=new Date;a.setTime(a.getTime()+36e5*n),r=""==r?"":";path="+r,_expires="string"==typeof n?"":";expires="+a.toUTCString(),document.cookie=e+"="+t+_expires+r},getCookieValue:function(e){var e=escape(e),t=document.cookie;e+="=";var n=t.indexOf(e);if(n!=-1){var r=n+e.length,a=t.indexOf(";",r);a==-1&&(a=t.length);var o=t.substring(r,a);return o}return""},deleteCookie:function(e,t){var e=escape(e),n=new Date(0);t=""==t?"":";path="+t,document.cookie=e+"=;expires="+n.toUTCString()+t},password:function(e,t,n,r){var a=/\s+/,o=/((?=[\x21-\x7e]+)[^A-Za-z0-9])+/,i=/^(?![0-9]+$)(?![a-zA-Z]+$)[0-9A-Za-z]{6,16}$/;return e||0!=e.length?a.test(e)?"密码不能包含空格":o.test(e)?"密码不能包含特殊符号":!!i.test(e)||"密码需由6-16数字与英文构成":"密码不能包含空格"},advert:function(e){var t,n=$.extend({target:"#ad",code:"",area:["100%","auto"],layer:!1,animate:!1,timeout:0,close:!0,random:!1,swiper:!1,style:{},onclose:function(){}},e),r=$(n.target),a=n.area[0],o=n.area[1],i=n.withBackground;r.css({display:"none"});var s=function(e){for(var t=[],n=0;n<e.length;n++){var r=e[n],a=r.activity1_url,o=encodeURI(r.activity1_img_url),s=i?'<a class="swiper-slide s-advert-imte" style="width: 100%; height: 100%; display: block; background-image: url('+o+'); background-position: center; background-repeat: no-repeat; background-size: cover;" target="_blank" href="'+a+'"></a>':'<a class="swiper-slide s-advert-imte" style="overflow: hidden; width: 100%; height: 100%; display: block;" target="_blank" href="'+a+'"><img style="display: block; width: 100%;" src="'+o+'" /></a>';t.push(s)}return t},c=function(){new Swiper(n.target,n.swiper||{})},l=function(){t=layer.open($.extend({title:!1,type:1,closeBtn:!1,scrollbar:!1,zIndex:99999,area:n.area,content:r},n.layer))},d=function(e){if(!e.length)return void r.hide();r.css($.extend({display:"block",overflow:"hidden",position:"relative",width:a},n.style)),r[n.animate?"animate":"css"]({height:o}),r.append('<div class="s-advert-wrapper swiper-wrapper" style="position: relative; width: 100%; height: 100%"></div>');var i=r.find(".s-advert-wrapper");n.random&&(e=[e[Math.floor(Math.random()*e.length)]]);var d=s(e);i.append(d.join("")),n.swiper&&n.layer?(c(),l()):n.swiper?c():n.layer&&l(),n.close&&(r.append('<span class="s-advert-close" unselectable="on"><i class="iconfont icon-error"></i></span>'),r.find(".s-advert-close").on("click",function(){t?layer.close(t):r.slideUp(),n.onclose&&n.onclose()}))};$.get("/index/appOperation",{code:n.code}).then(function(e){var t=e.data||{},r=t[n.code]||[];setTimeout(function(){d(r)},n.delay)})}};return a}])}();